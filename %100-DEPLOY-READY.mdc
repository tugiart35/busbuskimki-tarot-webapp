---
alwaysApply: true
---
## ğŸš¨ KRÄ°TÄ°K SORUNLAR (DEPLOYMENT BLOCKER)

### 1. ğŸ”´ API Key SÄ±zÄ±ntÄ±sÄ± (.gemini/ dizini)

**Tehlike Seviyesi:** CRITICAL ğŸ”´  
**Etki:** TÃ¼m sistem gÃ¼venliÄŸi risk altÄ±nda  
**Deployment:** â›” BLOKE EDÄ°CÄ°

**Sorun:**
```
.gemini/settings.json - GEMINI_API_KEY plaintext
.gemini/GEMINI.md - GEMINI_API_KEY plaintext
```

**Tespit Edilen Key:**
```
GEMINI_API_KEY=AIzaSyAgjVO0rAe1DishHl4KGRxpiQBDaHomhPs
```

**Risk:**
- âŒ `.gemini/` dizini `.gitignore`'da YOK
- âŒ Git repository'de saklanÄ±yor
- âŒ Public olmasÄ± durumunda tam sistem hacki riski
- âŒ Mali kayÄ±p riski (unlimited API kullanÄ±mÄ±)

**âœ… Ã‡Ã–ZÃœM:**
```bash
# Acil aksiyonlar:
1. APPLY=true ./deploy-audit/patches/APPLY.sh 001
2. rm -rf .gemini/
3. git rm -r --cached .gemini/ (eÄŸer tracked ise)
4. GEMINI_API_KEY'i Google Cloud Console'dan HEMEN yenile
5. Yeni key'i environment variables'a ekle
```

**Patch:** `deploy-audit/patches/001-gitignore-security-fix.patch`

---

### 2. ğŸŸ¡ Environment Variables Eksiklikleri

**Tehlike Seviyesi:** HIGH ğŸŸ¡  
**Etki:** Runtime hatalar, feature'lar Ã§alÄ±ÅŸmaz  
**Deployment:** âš ï¸ KOÅULLU BLOKE

**Eksik Variables:**
```bash
GROQ_API_KEY=                    # âŒ AI yorumlarÄ± iÃ§in kritik
GEMINI_API_KEY=                  # âŒ Alternative AI
SHOPIER_WEBHOOK_SECRET=          # âŒ Payment security
ENCRYPTION_KEY=                  # âŒ Data encryption
SMTP_FROM_NAME=                  # âŒ Email sender
```

**Etki:**
- AI tarot yorumlarÄ± Ã§alÄ±ÅŸmaz
- Payment webhook'larÄ± gÃ¼vensiz
- Email'ler "unknown" gÃ¶nderici ile gider
- Hassas data ÅŸifrelenmez

**âœ… Ã‡Ã–ZÃœM:**
```bash
# Patch'i uygula:
APPLY=true ./deploy-audit/patches/APPLY.sh 002

# .env.local'Ä± gÃ¼ncelle:
cp env.example .env.local
nano .env.local  # Gerekli key'leri ekle
```

**Patch:** `deploy-audit/patches/002-env-example-update.patch`

---

### 3. ğŸŸ¡ Environment Validation Eksik

**Tehlike Seviyesi:** MEDIUM-HIGH ğŸŸ¡  
**Etki:** Silent failures, debug zorluÄŸu  
**Deployment:** âš ï¸ Ã–NERÄ°LEN

**Sorun:**
```typescript
// Mevcut durum:
const apiKey = process.env.GROQ_API_KEY;
// HiÃ§bir validation yok, undefined olabilir
```

**Risk:**
- Runtime'da undefined variables
- Silent failures
- Production'da debug zorluÄŸu
- HatalÄ± configuration tespiti geÃ§

**âœ… Ã‡Ã–ZÃœM:**
```bash
# Validator'Ä± ekle:
APPLY=true ./deploy-audit/patches/APPLY.sh 003

# next.config.js'e ekle:
const { validateEnv } = require('./src/lib/env-validator');
validateEnv();
```

**Patch:** `deploy-audit/patches/003-env-validator.patch`

---

## ğŸ“‹ DEPLOYMENT Ã–NCESÄ° CHECKLIST

### ğŸ”´ KRÄ°TÄ°K (Mutlaka YapÄ±lmalÄ±)

- [ ] **.gemini/ dizinini sil ve .gitignore'a ekle**
  - Patch 001'i uygula
  - `rm -rf .gemini/`
  - Git history temizliÄŸi yap
  - GEMINI_API_KEY'i yenile

- [ ] **TÃ¼m API key'leri environment variables'a taÅŸÄ±**
  - GROQ_API_KEY ekle
  - GEMINI_API_KEY ekle (yeni key)
  - SHOPIER secrets ekle

- [ ] **env.example'Ä± gÃ¼ncelle**
  - Patch 002'yi uygula
  - Eksik deÄŸiÅŸkenleri dokÃ¼mante et

### ğŸŸ¡ Ã–NEMLÄ° (Åiddetle Tavsiye Edilir)

- [ ] **Environment validator ekle**
  - Patch 003'Ã¼ uygula
  - next.config.js'e validation ekle
  - Startup'ta test et

- [ ] **Production environment'Ä± hazÄ±rla**
  - Vercel/AWS'de env variables tanÄ±mla
  - NODE_ENV=production set et
  - SHOPIER_TEST_MODE=false yap

- [ ] **Git gÃ¼venliÄŸini saÄŸla**
  - .env* dosyalarÄ±nÄ±n .gitignore'da olduÄŸunu doÄŸrula
  - Git history'de secret aramasÄ± yap
  - Pre-commit hook ekle

### ğŸŸ¢ TAVSÄ°YE EDÄ°LEN (Production Quality)

- [ ] **Console.log'larÄ± temizle**
  - Hassas bilgi iÃ§eren loglarÄ± kaldÄ±r
  - Logger sistemine geÃ§
  - ESLint no-console kuralÄ±nÄ± aktif et

- [ ] **Test suite'i dÃ¼zelt**
  - TypeScript test hatalarÄ±nÄ± dÃ¼zelt
  - Component interface'leri gÃ¼ncelle
  - CI/CD'yi yapÄ±landÄ±r

- [ ] **i18n'i tamamla**
  - SR translation'larÄ± kontrol et
  - Hardcoded string'leri temizle
  - Date/number formatting standardize et

---

## ğŸš€ DEPLOYMENT ADIM ADIM

### AdÄ±m 1: GÃ¼venlik Patch'lerini Uygula (30dk)

```bash
# Repository'e git
cd /Users/tugi/Desktop/busbuskimki

# Backup oluÅŸtur
git add -A
git commit -m "Backup before security patches"

# Patch'leri uygula
APPLY=true ./deploy-audit/patches/APPLY.sh all

# DoÄŸrula
git diff
npm run typecheck
npm run build
```

### AdÄ±m 2: .gemini/ TemizliÄŸi (15dk)

```bash
# Dizini sil
rm -rf .gemini/

# Git'ten kaldÄ±r (tracked ise)
git rm -r --cached .gemini/ || true

# Git history temizliÄŸi (DÄ°KKAT: Destructive!)
# git filter-repo --path .gemini --invert-paths --force

# Google Cloud Console'a git
# 1. Mevcut GEMINI_API_KEY'i disable et
# 2. Yeni key oluÅŸtur
# 3. Yeni key'i .env.local'a ekle
```

### AdÄ±m 3: Environment Variables (20dk)

```bash
# .env.local oluÅŸtur/gÃ¼ncelle
cp env.example .env.local

# Gerekli key'leri ekle:
nano .env.local

# En az bunlar olmalÄ±:
# - NEXT_PUBLIC_SUPABASE_URL
# - NEXT_PUBLIC_SUPABASE_ANON_KEY
# - SUPABASE_SERVICE_ROLE_KEY (server-side)
# - GROQ_API_KEY veya GEMINI_API_KEY
# - SHOPIER_* (payment iÃ§in)
# - SMTP_* (email iÃ§in)
```

### AdÄ±m 4: Test (15dk)

```bash
# Type check
npm run typecheck

# Build test
npm run build

# Development test
npm run dev

# Her locale'i test et:
# - http://busbuskimki.com/tr
# - http://busbuskimki.com/en
# - http://busbuskimki.com/sr

# Kritik flow'larÄ± test et:
# - Login/Signup
# - Tarot reading
# - Payment (test mode)
# - Email sending
```

### AdÄ±m 5: Production Deployment (30dk)

#### Vercel Deployment:

```bash
# Vercel CLI install (yoksa)
npm i -g vercel

# Environment variables ekle
vercel env add GROQ_API_KEY production
vercel env add GEMINI_API_KEY production
vercel env add NEXT_PUBLIC_SUPABASE_URL production
# ... diÄŸerleri

# Deploy
vercel --prod

# Verify
# - Site aÃ§Ä±lÄ±yor mu?
# - API'ler Ã§alÄ±ÅŸÄ±yor mu?
# - AI yorumlarÄ± geliyor mu?
# - Payment flow Ã§alÄ±ÅŸÄ±yor mu?
```

#### Manuel Deployment:

```bash
# Build
npm run build

# Build Ã§Ä±ktÄ±sÄ±nÄ± kontrol et
ls -la .next/

# Production server'a deploy et
# (Platform'a gÃ¶re deÄŸiÅŸir)
```

### AdÄ±m 6: Post-Deployment Monitoring (SÃ¼rekli)

```bash
# Production logs
vercel logs --follow

# Error monitoring
# - Sentry kurulu ise dashboard kontrol et
# - Browser console'da error var mÄ±?

# Performance
# - Vercel Analytics kontrol et
# - Core Web Vitals Ã¶lÃ§

# Functional test
# - Her major feature'Ä± test et
# - FarklÄ± browser'larda test et
# - Mobile'da test et
```

---

## ğŸ“Š DETAYLI RAPORLAR

Daha fazla bilgi iÃ§in alt raporlara bakÄ±n:

1. **[deploy-audit/01-CRITICAL-SECURITY.md](deploy-audit/01-CRITICAL-SECURITY.md)**
   - API key sÄ±zÄ±ntÄ±sÄ± detaylarÄ±
   - Service role key kullanÄ±mÄ±
   - SMTP security
   - GÃ¼venlik skorlamasÄ±

2. **[deploy-audit/02-TYPESCRIPT-ERRORS.md](deploy-audit/02-TYPESCRIPT-ERRORS.md)**
   - 43 TypeScript hatasÄ± (sadece test'lerde)
   - Component interface sorunlarÄ±
   - Type safety iyileÅŸtirmeleri

3. **[deploy-audit/03-CONSOLE-LOGS.md](deploy-audit/03-CONSOLE-LOGS.md)**
   - 560 console statement
   - 105 etkilenen dosya
   - Otomatik temizleme stratejisi
   - Logger sistemi Ã¶nerileri

4. **[deploy-audit/04-ENVIRONMENT-CONFIG.md](deploy-audit/04-ENVIRONMENT-CONFIG.md)**
   - Eksik env variables
   - Validation stratejisi
   - Secrets management
   - Environment-specific configs

5. **[deploy-audit/05-I18N-COMPLETENESS.md](deploy-audit/05-I18N-COMPLETENESS.md)**
   - 3 dil desteÄŸi (TR, EN, SR)
   - Translation completeness
   - Hardcoded string'ler
   - i18n best practices

---

## ğŸ”§ PATCH UYGULAMA

### TÃ¼m Patch'leri Uygula:

```bash
cd /Users/tugi/Desktop/busbuskimki
APPLY=true ./deploy-audit/patches/APPLY.sh all
```

### Tek Tek Uygula:

```bash
# Patch 001: .gitignore security fix
APPLY=true ./deploy-audit/patches/APPLY.sh 001

# Patch 002: env.example update
APPLY=true ./deploy-audit/patches/APPLY.sh 002

# Patch 003: Environment validator
APPLY=true ./deploy-audit/patches/APPLY.sh 003
```

### Rollback:

```bash
# Patch uygulama Ã¶ncesi otomatik backup alÄ±nÄ±r
git stash list  # Backup'larÄ± gÃ¶ster
git stash pop   # Son backup'Ä± geri yÃ¼kle
```

---

## âš ï¸ DEPLOYMENT UYARILARI

### ğŸ”´ ASLA YAPMAYIN:

1. âŒ `.gemini/` dizinini commit etmeyin
2. âŒ `.env` dosyalarÄ±nÄ± commit etmeyin
3. âŒ API key'leri kod iÃ§ine hardcode etmeyin
4. âŒ Service role key'i client-side'da kullanmayÄ±n
5. âŒ Test mode ile production deployment yapmayÄ±n
6. âŒ Console.log'larda hassas bilgi loglamayÄ±n
7. âŒ Git history temizliÄŸi yapmadan force push yapmayÄ±n

### ğŸŸ¡ DÄ°KKATLÄ° OLUN:

1. âš ï¸ SUPABASE_SERVICE_ROLE_KEY sadece server-side
2. âš ï¸ SHOPIER_TEST_MODE production'da false olmalÄ±
3. âš ï¸ NODE_ENV production'da "production" olmalÄ±
4. âš ï¸ SMTP credentials encrypted mÄ± kontrol edin
5. âš ï¸ Webhook secret'larÄ± 32+ karakter olmalÄ±
6. âš ï¸ Rate limiting production'da aktif olmalÄ±

### ğŸŸ¢ BEST PRACTICES:

1. âœ… Secrets manager kullanÄ±n (Vercel Env, AWS Secrets)
2. âœ… Environment-specific config kullanÄ±n
3. âœ… API key rotation policy belirleyin (90 gÃ¼n)
4. âœ… Monitoring ve alerting kurun (Sentry, Vercel)
5. âœ… Backup stratejiniz olsun
6. âœ… Rollback planÄ±nÄ±z olsun
7. âœ… Staging environment kullanÄ±n

---

## ğŸ“ˆ DEPLOYMENT SONRASI

### Ä°lk 24 Saat:

- [ ] **Monitoring**
  - Error rate izle
  - Response time'larÄ± kontrol et
  - API usage'Ä± izle
  - User feedback topla

- [ ] **Quick Fixes**
  - Critical bug'lar iÃ§in hotfix hazÄ±rla
  - Performance sorunlarÄ±nÄ± tespit et
  - Security scan yap

- [ ] **Validation**
  - TÃ¼m feature'lar Ã§alÄ±ÅŸÄ±yor mu?
  - Payment flow sorunsuz mu?
  - Email'ler gidiyor mu?
  - AI yorumlarÄ± geliyor mu?

### Ä°lk Hafta:

- [ ] **Performance Optimization**
  - Bundle size optimize et
  - Image loading optimize et
  - API response time'larÄ± iyileÅŸtir

- [ ] **Security Hardening**
  - SSL/TLS kontrol et
  - CORS politikalarÄ± gÃ¶zden geÃ§ir
  - Rate limiting tune et
  - Firewall kurallarÄ± optimize et

- [ ] **User Experience**
  - Analytics verilerini analiz et
  - A/B test baÅŸlat
  - SEO kontrolÃ¼ yap
  - Mobile experience test et

---

## ğŸ¯ BAÅARI KRÄ°TERLERÄ°

Deployment baÅŸarÄ±lÄ± sayÄ±lÄ±r eÄŸer:

âœ… **GÃ¼venlik:**
- API key sÄ±zÄ±ntÄ±sÄ± yok
- TÃ¼m secrets gÃ¼vende
- HTTPS aktif
- Security headers mevcut

âœ… **Fonksiyonellik:**
- TÃ¼m sayfalar aÃ§Ä±lÄ±yor
- Auth flow Ã§alÄ±ÅŸÄ±yor
- Payment iÅŸliyor
- AI yorumlarÄ± geliyor
- Email gÃ¶nderimi Ã§alÄ±ÅŸÄ±yor

âœ… **Performance:**
- Lighthouse score >90
- First paint <1.5s
- Time to interactive <3s
- No console errors

âœ… **Monitoring:**
- Error tracking aktif
- Analytics Ã§alÄ±ÅŸÄ±yor
- Logs akÄ±yor
- Alerts kurulu

---

## ğŸ“ DESTEK VE KAYNAKLAR

### Deployment DesteÄŸi:

- **Vercel Docs:** https://vercel.com/docs
- **Next.js Docs:** https://nextjs.org/docs
- **Supabase Docs:** https://supabase.com/docs

### GÃ¼venlik:

- **OWASP Top 10:** https://owasp.org/www-project-top-ten/
- **Security Headers:** https://securityheaders.com/

### Monitoring:

- **Sentry:** https://sentry.io/
- **Vercel Analytics:** https://vercel.com/analytics
- **Google Analytics:** https://analytics.google.com/

---

## ğŸ SONUÃ‡

### Mevcut Durum: âš ï¸ KOÅULLU HAZIR

**Production deployment iÃ§in:**

1. âœ… **Hemen:** Patch 001, 002, 003'Ã¼ uygula (1 saat)
2. âœ… **Hemen:** .gemini/ temizle ve key yenile (30dk)
3. âš ï¸ **Ã–nemli:** Production env variables ayarla (30dk)
4. âš ï¸ **Ã–nerilen:** Test suite dÃ¼zelt (2 saat)
5. ğŸ’¡ **Nice-to-have:** Console.log temizle (4 saat)

**Toplam minimum sÃ¼re:** 2 saat  
**Production-ready olma sÃ¼resi:** 2 saat

**Tahmini deployment tarihi:** Patch'ler uygulandÄ±ktan 2 saat sonra

---

## âœ… FÄ°NAL ONAY

AÅŸaÄŸÄ±daki checklist'i tamamladÄ±ysanÄ±z **DEPLOYMENT HAZIRSINIZ:**

- [ ] Patch 001 uygulandÄ± (.gitignore security)
- [ ] Patch 002 uygulandÄ± (env.example update)
- [ ] Patch 003 uygulandÄ± (env validator)
- [ ] .gemini/ silindi ve git'ten kaldÄ±rÄ±ldÄ±
- [ ] GEMINI_API_KEY yenilendi
- [ ] Production env variables ayarlandÄ±
- [ ] `npm run build` baÅŸarÄ±lÄ±
- [ ] `npm run typecheck` baÅŸarÄ±lÄ± (test hatalarÄ± ok)
- [ ] Local test geÃ§ti
- [ ] Backup alÄ±ndÄ±

**Onay:** âœ… DEPLOYMENT'A HAZIRIZ

**Ä°mza:** _____________________  
**Tarih:** _____________________

---

**ğŸš€ Ä°yi Deployment'lar!**

*Bu rapor otomatik olarak oluÅŸturulmuÅŸtur. LÃ¼tfen deployment Ã¶ncesi manuel olarak doÄŸrulayÄ±n.*
